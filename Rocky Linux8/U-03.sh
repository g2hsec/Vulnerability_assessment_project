cat << EOF
===== [U-03] Set Account Lock Threshold                 =====
=====                  Chaking...........               =====
EOF
echo "--------------------------------------------------------------------------" >> $target
echo "                        U-03 ê³„ì • ìž ê¸ˆ ìž„ê³„ê°’ ì„¤ì •                        " >> $target
echo "--------------------------------------------------------------------------" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "ì ê²€ëª©ì  : ê³„ì •íƒˆì·¨ ëª©ì ì˜ ë¬´ìž‘ìœ„ ëŒ€ìž… ê³µê²© ì‹œ í•´ë‹¹ ê³„ì •ì„ ìž ê¸ˆí•˜ì—¬ ì¸ì¦ ìš”ì²­ì— ì‘ë‹µí•˜ëŠ” ë¦¬ì†ŒìŠ¤ ë‚­ë¹„ë¥¼ ì°¨ë‹¨í•˜ê³  ëŒ€ìž… ê³µê²©ìœ¼ë¡œ ì¸í•œ ë¹„ë°€ë²ˆí˜¸ ë…¸ì¶œ ê³µê²©ì„ ë¬´ë ¥í™”í•˜ê¸° ìœ„í•¨" >> $target
echo "ë³´ì•ˆìœ„í˜‘ : íŒ¨ìŠ¤ì›Œë“œ íƒˆì·¨ ê³µê²©(ë¬´ìž‘ìœ„ ëŒ€ìž… ê³µê²©, ì‚¬ì „ ëŒ€ìž… ê³µê²©, ì¶”ì¸¡ ê³µê²© ë“±)ì˜ ì¸ì¦ ìš”ì²­ì— ëŒ€í•´ ì„¤ì •ëœ íŒ¨ìŠ¤ì›Œë“œì™€ ì¼ì¹˜ í•  ë•Œê¹Œì§€ ì§€ì†ì ìœ¼ë¡œ ì‘ë‹µí•˜ì—¬ í•´ë‹¹ ê³„ì •ì˜ íŒ¨ìŠ¤ì›Œë“œê°€ ìœ ì¶œ ë  ìˆ˜ ìžˆìŒ" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì–‘í˜¸ ðŸ”˜: ê³„ì • ìž ê¸ˆ ìž„ê³„ê°’ì´ 10íšŒ ì´í•˜ì˜ ê°’ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìžˆëŠ” ê²½ìš°" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì·¨ì•½ ðŸš«: ê³„ì • ìž ê¸ˆ ìž„ê³„ê°’ì´ ì„¤ì •ë˜ì–´ ìžˆì§€ ì•Šê±°ë‚˜, 10íšŒ ì´í•˜ì˜ ê°’ìœ¼ë¡œ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "" >> $target
echo "-------------" >> $result
echo "U-3 ì ê²€ ê²°ê³¼" >> $result
u3=0
u3_safe_check=0
u3_Account_Management=0
u3_auth_files=("/etc/pam.d/system-auth" "/etc/pam.d/password-auth")
for u3_auth_file in "${u3_auth_files[@]}";do
    echo "" >> $target
    echo "$u3_auth_file íŒŒì¼ ì ê²€" >> $target
    if [ -e "$u3_auth_file" ]; then
        u3_auth_module_check=("pam_tally.so" "pam_tally2.so" "pam_faillock.so")    
        u3_auth_stacks=("auth" "account")
        u3_modules_found=0
        for u3_auth_module in "${u3_auth_module_check[@]}";do
            echo "$u3_auth_module ì ê²€" >> $target
            for u3_auth_stack in "${u3_auth_stacks[@]}";do
                if grep -qiE "^\s*$u3_auth_stack\s+.*$u3_auth_module" "$u3_auth_file";then
                    echo "$u3_auth_stack ì— ëŒ€í•œ $u3_auth_module ê°€ ì¡´ìž¬í•©ë‹ˆë‹¤." >> $target
                    u3_auth_check_values=$(grep -iE "^\s*$u3_auth_stack\s+.*$u3_auth_module"  "$u3_auth_file" | sed -E "s/^.*$u3_auth_module\s*//")
                    echo "$(grep -iE "^\s*$u3_auth_stack\s+.*$u3_auth_module" "$u3_auth_file")" >> $target
                    echo "í˜„ìž¬ $u3_auth_stack ì˜ $u3_auth_module ëª¨ë“ˆì— ì ìš©ëœ ì„¤ì •ê°’ì€ ì•„ëž˜ì™€ ê°™ìŠµë‹ˆë‹¤." >> $target
                    echo "$u3_auth_check_values" | sed 's/\s\+/\n/g' | while read -r auth_field; do
                            echo "$u3_auth_field" >> $target
                            done
                    echo "--------------------" >> $target
                    if [[ $u3_auth_stack == "auth" ]];then
                        u3_deny_count=$(grep -iE "^\s*auth\s+.*$u3_auth_module" "$u3_auth_file" | sed -E "s/^.*$u3_auth_module\s*//" | grep -oP 'deny=\K\d+')
                        if (( $u3_deny_count <= 10 )); then
                            echo "ê³„ì • ìž„ê³„ê°’ ì„¤ì •ì´ $u3_deny_count ë¡œ ë³´ì•ˆê¶Œê³  ì‚¬í•­ì¸ 10 ì´í•˜ë¡œ ì ì ˆí•˜ê²Œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤." >> "$target"
                            echo "--------------------" >> $target
                        else
                            echo "ê³„ì • ìž„ê³„ê°’ ì„¤ì •ì´ $u3_deny_count ë¡œ ë³´ì•ˆê¶Œê³  ì‚¬í•­ì¸ 10 ì´ìƒìœ¼ë¡œ ë¶€ì ì ˆí•˜ê²Œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤." >> "$target"
                            echo "--------------------" >> $target
                            u3_safe_check=$((u3_safe_check+1))
                            u3_Account_Management=$((u3_Account_Management+1))
                        fi
                    fi
                else
                    if grep -qiE "^\s*#.*$u3_auth_stack\s+.*$u3_auth_module" "$u3_auth_file"; then  
                        echo "ê³„ì • ìž„ê³„ê°’ ì„¤ì • ëª¨ë“ˆ($u3_auth_module)ì´ ì£¼ì„ì²˜ë¦¬ ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> $target
                        u3_safe_check=$((u3_safe_check+1))
                        u3_Account_Management=$((u3_Account_Management+1))
                    else    
                        echo "$u3_auth_moduleê°€ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
                        break
                    fi
                fi
            done
        done
    else
        echo "$u3_auth_file íŒŒì¼ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
    fi
done

if [ $u3_safe_check -ge 1 ];then
    u3=$((u3+1))
    echo "ì ê²€ ê²°ê³¼ : ì·¨ì•½" >> $result
else
    echo "ì ê²€ ê²°ê³¼ : ì–‘í˜¸" >> $result
fi
if [[ $u3 -ge 1 ]];then
    High=$((High+1))
    Account_Management=$((Account_Management+1))
    u3_Account_Management=1
fi
