cat << EOF
===== [U-18] Access IP and Port Restrictions              =====
=====                  Chaking...........               =====
EOF
echo "--------------------------------------------------------------------------" >> $target
echo "                        U-18 ì ‘ì† IP ë° í¬íŠ¸ ì œí•œ             " >> $target
echo "--------------------------------------------------------------------------" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "ì ê²€ëª©ì  : í—ˆìš©í•œ í˜¸ìŠ¤íŠ¸ë§Œ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê²Œ í•˜ì—¬ ì„œë¹„ìŠ¤ ì·¨ì•½ì ì„ ì´ìš©í•œ ì™¸ë¶€ì ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•¨" >> $target
echo "ë³´ì•ˆìœ„í˜‘ :  í—ˆìš©í•  í˜¸ìŠ¤íŠ¸ì— ëŒ€í•œ IP ë° í¬íŠ¸ì œí•œì´ ì ìš©ë˜ì§€ ì•Šì€ ê²½ìš°, Telnet, FTPê°™ì€ ë³´ì•ˆì— ì·¨ì•½í•œ ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ë¥¼ í†µí•˜ì—¬ ë¶ˆë²•ì ì¸ ì ‘ê·¼ ë° ì‹œìŠ¤í…œ ì¹¨í•´ì‚¬ê³ ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì–‘í˜¸ ğŸ”˜: ì ‘ì†ì„ í—ˆìš©í•  íŠ¹ì • í˜¸ìŠ¤íŠ¸ì— ëŒ€í•œ IP ì£¼ì†Œ ë° í¬íŠ¸ ì œí•œì„ ì„¤ì •í•œ ê²½ìš°" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì·¨ì•½ ğŸš«: ì ‘ì†ì„ í—ˆìš©í•  íŠ¹ì • í˜¸ìŠ¤íŠ¸ì— ëŒ€í•œ IP ì£¼ì†Œ ë° í¬íŠ¸ ì œí•œì„ ì„¤ì •í•˜ì§€ ì•Šì€ ê²½ìš°" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "" >> $target
echo "-------------" >> $result
echo "U-17 ì ê²€ ê²°ê³¼" >> $result
u18_Files_Directory_Management=0
u18_safe_check=0
u18=0
u18_allowcheck=10
if command -v iptables &> /dev/null; then
    echo "IPtables ì„œë¹„ìŠ¤ê°€ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤." >> $target
    if systemctl is-active --quiet "iptables";then
        echo "IPtables ì„œë¹„ìŠ¤ê°€ ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤." >> $target
        # ëª¨ë“  ACCEPT ê·œì¹™ì´ *ì™€ 0.0.0.0/0ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
        iptables -L -v -n | grep "ACCEPT" | grep -vE "^Chain" | while read -r u18_iptables_line; do
            # í•„ë“œë¥¼ ë¶„ë¦¬í•©ë‹ˆë‹¤.
            IFS=' ' read -r -a u18_iptables_fields <<< "$u18_iptables_line"
            # íŠ¸ë˜í”½ í—ˆìš© ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
            if [[ "${u18_iptables_fields[5]}" == "*" && \
                "${u18_iptables_fields[6]}" == "*" && \
                "${u18_iptables_fields[7]}" == "0.0.0.0/0" && \
                "${u18_iptables_fields[8]}" == "0.0.0.0/0" ]]; then
                # ì²´í¬í•  ì²´ì¸ ë°°ì—´
                u18_chains=("INPUT" "OUTPUT" "FORWARD")

                # ê° ì²´ì¸ì— ëŒ€í•´ ê¸°ë³¸ ì •ì±…ê³¼ ê·œì¹™ í™•ì¸
                for u18_chain in "${u18_chains[@]}"; do
                    # ê¸°ë³¸ ì •ì±… í™•ì¸
                    u18_default_policy=$(iptables -L $u18_chain -n | grep "Chain $u18_chain" | awk '{print $4}')

                    # ê¸°ë³¸ ì •ì±…ì´ DROPì¸ì§€ í™•ì¸
                    if [ "$u18_default_policy" == "DROP" ]; then
                        # ê·œì¹™ì´ ìˆëŠ”ì§€ í™•ì¸
                        u18_rules=$(iptables -L $u18_chain -v -n | grep -v "^Chain")

                        # ê·œì¹™ì´ ì—†ëŠ” ê²½ìš°
                        if [ -z "$u18_rules" ]; then
                            echo "DROP ì •ì±…ì´ ê¸°ë³¸ ì •ì±…ìœ¼ë¡œ ë˜ì–´ ìˆì§€ë§Œ ê·œì¹™ì´ ì—†ìœ¼ë©°, ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ëŠ” ì •ì±…ì´ ì„¤ì •ë˜ì–´ ìˆì–´ ì·¨ì•½í•©ë‹ˆë‹¤." >> $target
                            echo "ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ëŠ” ê·œì¹™: $u18_iptables_line" >> $target
                            u18_allowcheck=$((u18_allowcheck-1))
                            u18_safe_check=$((u18_safe_check+1))
                            break
                        else
                            echo "DROP ì •ì±…ì´ ê¸°ë³¸ ì •ì±…ìœ¼ë¡œ ë˜ì–´ ìˆì§€ë§Œ ê·œì¹™ì´ ì¡´ì¬í•˜ë©°, ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ëŠ” ì •ì±…ì´ ì„¤ì •ë˜ì–´ ìˆì–´ ì·¨ì•½í•©ë‹ˆë‹¤." >> $target
                            echo "ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ëŠ” ê·œì¹™: $u18_iptables_line" >> $target
                            u18_allowcheck=$((u18_allowcheck-1))
                            u18_safe_check=$((u18_safe_check+1))
                            break
                        fi
                    else
                        echo "ê¸°ë³¸ ì •ì±…ì´ DROPì´ ì•„ë‹ˆë©°, ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ëŠ” ì •ì±…ì´ ì„¤ì •ë˜ì–´ ìˆì–´ ì·¨ì•½í•©ë‹ˆë‹¤." >> $target
                        echo "ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ëŠ” ê·œì¹™: $u18_iptables_line" >> $target
                        u18_allowcheck=$((u18_allowcheck-1))
                        u18_safe_check=$((u18_safe_check+1))
                        break
                    fi
                done
            fi
        done
        if [[ $u18_allowcheck -eq 10 ]];then
            echo "ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ëŠ” ì •ì±…ì´ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šì•„ ì–‘í˜¸í•©ë‹ˆë‹¤." >> $target
        fi
    else
        echo "IPtables ì„œë¹„ìŠ¤ê°€ ì‚¬ìš©ì¤‘ì´ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
    fi
else
    echo "IPtables ì„œë¹„ìŠ¤ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤."  >> $target
fi
if [ -f "/sbin/ipf" ];then
    ehco "IPfilterë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤." >> $target
    u18_ipfilterfiles=("/etc/ipf/ipf.conf" "/etc/ipf/ipf.rules")
    for u18_ipfilterfile in "${u18_ipfilterfiles[@]}";do
        if [ -e "$u18_ipfilterfile" ];then
            if grep -q "pass" "$u18_ipfilterfile" && ! grep -q "block" "$u18_ipfilterfile"; then
                echo "ê¸°ë³¸ ì •ì±…ì´ ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤." >> $target
                u18_safe_check=$((u18_safe_check+1))
                if ipf -l | grep -E "pass in|pass out"; then
                    echo "ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ëŠ” ê·œì¹™ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤." >> $target
                    u18_allowcheck=$((u18_allowcheck+1))
                    u18_safe_check=$((u18_safe_check+1))
                else
                    echo "ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ëŠ” ê·œì¹™ì´ ì—†ìŠµë‹ˆë‹¤." >> $target
                fi
            else
                echo "ê¸°ë³¸ ì •ì±…ì— ë¸”ë¡ ê·œì¹™ì´ í¬í•¨ë˜ì–´ ìˆê±°ë‚˜ ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
            fi
        else    
            echo "ipfilterì„¤ì •íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
        fi 
    done
else
    echo "IPfilterë¥¼ ì‚¬ìš©í•˜ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
fi
# TCP Wrapperë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸
if [[ -f "/usr/sbin/tcpd" || -x "$(command -v tcpd)" ]]; then
    echo "TCP Wrapperë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤." >> $target

    # /etc/hosts.allow íŒŒì¼ ì ê²€
    if [ -f "/etc/hosts.allow" ]; then
        if grep -vq "^\s*#" "/etc/hosts.allow";then
            if grep -iE "^\s*ALL:ALL\s*" "/etc/hosts.allow" | grep -qv "^\s*#"; then
                echo "/etc/hosts.allow íŒŒì¼ì— ALL:ALL ì„¤ì •ì´ ë˜ì–´ ìˆì–´ ì·¨ì•½í•©ë‹ˆë‹¤." >> $target
                u18_allowcheck=$((u18_allowcheck+1))
                u18_safe_check=$((u18_safe_check+1))
            else
                echo "/etc/hosts.allow íŒŒì¼ì— ALL:ALL ì„¤ì •ì´ ë˜ì–´ ìˆì§€ ì•Šì•„ ì–‘í˜¸í•©ë‹ˆë‹¤." >> $target
            fi
        else
            echo "/etc/hosts.allow íŒŒì¼ ë‚´ì— ì„¤ì •ê°’ë“¤ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
        fi
    else
        echo "/etc/hosts.allow íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
    fi

    # /etc/hosts.deny íŒŒì¼ ì ê²€
    if [ -f "/etc/hosts.deny" ]; then
        if grep -vq "^\s*#" "/etc/hosts.deny";then
            if grep -iE "^\s*ALL:ALL\s*" "/etc/hosts.deny" | grep -qv "^\s*#"; then
                echo "/etc/hosts.deny íŒŒì¼ì— ALL:ALL ì„¤ì • í•­ëª©ì´ ì¡´ì¬í•˜ì—¬ ì–‘í˜¸í•©ë‹ˆë‹¤." >> $target
            else
                echo "/etc/hosts.deny íŒŒì¼ì— ALL:ALL ì„¤ì • í•­ëª©ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ ì·¨ì•½í•©ë‹ˆë‹¤." >> $target
                u18_allowcheck=$((u18_allowcheck+1))
                u18_safe_check=$((u18_safe_check+1))
            fi
        else
            echo "/etc/hosts.deny íŒŒì¼ ë‚´ì— ì„¤ì •ê°’ë“¤ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
        fi
    else
        echo "/etc/hosts.deny íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
    fi

else
    echo "TCP Wrapperë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
fi

if [[ $u18_safe_check -ge 1 ]];then
    u18=$((u18+1))
    echo "ì ê²€ ê²°ê³¼ : ì·¨ì•½" >> $result
else
    echo "ì ê²€ ê²°ê³¼ : ì–‘í˜¸" >> $result
fi
if [[ $u18 -ge 1 ]];then
    High=$((High+1))
    Files_Directory_Management=$((Files_Directory_Management+1))
    u18_Files_Directory_Management=1
fi