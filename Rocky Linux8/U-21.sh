cat << EOF
===== [U-21] Disabling r Family Services              =====
=====                  Chaking...........               =====
EOF
echo "--------------------------------------------------------------------------" >> $target
echo "                        U-21  r ê³„ì—´ ì„œë¹„ìŠ¤ ë¹„í™œì„±í™”             " >> $target
echo "--------------------------------------------------------------------------" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "ì ê²€ëª©ì  : r-command ì‚¬ìš©ì„ í†µí•œ ì›ê²© ì ‘ì†ì€ NET Backup ë˜ëŠ” í´ëŸ¬ìŠ¤í„°ë§ ë“± ìš©ë„ë¡œ ì‚¬ìš©ë˜ê¸°ë„ í•˜ë‚˜, ì¸ì¦ ì—†ì´ ê´€ë¦¬ìž ì›ê²©ì ‘ì†ì´ ê°€ëŠ¥í•˜ì—¬ ì´ì— ëŒ€í•œ ë³´ì•ˆìœ„í˜‘ì„ ë°©ì§€í•˜ê³ ìž í•¨" >> $target
echo "ë³´ì•ˆìœ„í˜‘ :  rsh, rlogin, rexec ë“±ì˜ r commandë¥¼ ì´ìš©í•˜ì—¬ ì›ê²©ì—ì„œ ì¸ì¦ì ˆì°¨ ì—†ì´ í„°ë¯¸ë„ ì ‘ì†, ì‰˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì´ ê°€ëŠ¥í•¨" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì–‘í˜¸ ðŸ”˜: ë¶ˆí•„ìš”í•œ r ê³„ì—´ ì„œë¹„ìŠ¤ê°€ ë¹„í™œì„±í™” ë˜ì–´ ìžˆëŠ” ê²½ìš°" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì·¨ì•½ ðŸš«: ë¶ˆí•„ìš”í•œ r ê³„ì—´ ì„œë¹„ìŠ¤ê°€ í™œì„±í™” ë˜ì–´ ìžˆëŠ” ê²½ìš°" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "" >> $target
echo "-------------" >> $result
echo "U-21 ì ê²€ ê²°ê³¼" >> $result
u21_Service_Management=0
u21_safe_check=0
u21=0
u21_checkrcommands=("rsh" "rlogin" "rexec" "shell" "login" "exec")
u21_doublechecks=("shell" "login" "exec")
u21_checkports=("514" "513" "512")
u21_cmdlen=${#u21_checkrcommands[@]}

for u21_checkrcommand in "${u21_checkrcommands[@]}"; do 
    u21_checkservice=$(systemctl status "$u21_checkrcommand" 2> /dev/null | grep -i "Active" | grep -i "running" | awk -F')' '{print tolower($1)}' | tr -d ' ')
    if [ "$u21_checkservice"  == "active:active(running" ]; then
        for u21_checkport in "${u21_checkports[@]}"; do
            u21_checkprotstat=$(netstat -tlun | awk '{print $4}' | grep "$u21_checkport")
            if [ -n "$u21_checkprotstat" ]; then
                echo "$u21_checkrcommand ì„œë¹„ìŠ¤ê°€ ë™ìž‘ ì¤‘ì´ë©°, $u21_checkport í¬íŠ¸ë¡œ ë™ìž‘í•˜ê³  ìžˆìŠµë‹ˆë‹¤." >> $target
                u21_safe_check=$((u21_safe_check+1))
                break
            else
                echo "$u21_checkrcommand ì„œë¹„ìŠ¤ê°€ ë™ìž‘ ì¤‘ì´ì§€ë§Œ $u21_checkport í¬íŠ¸ë¡œ ë™ìž‘í•˜ê³  ìžˆì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
                u21_safe_check=$((u21_safe_check+))
                u21_newport=$(grep "^$u21_checkrcommand[[:space:]]" /etc/services | awk '{print $2}' | cut -d'/' -f1)
                u21_newportstat=$(netstat -tlun | awk '{print $4}' | grep -wE "$u21_newport")
                if [ -n "$u21_newportstat" ]; then
                    echo "$u21_checkrcommand ì„œë¹„ìŠ¤ê°€ $u21_newport í¬íŠ¸ë¡œ ë™ìž‘í•˜ê³  ìžˆìŠµë‹ˆë‹¤." >> $target
                    break
                fi
            fi
        done
    else
        echo "$u21_checkrcommand ì„œë¹„ìŠ¤ê°€ ë™ìž‘ ì¤‘ì´ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
    fi
done
for u21_checkrcommand_inetd in "${u21_checkrcommands[@]}"; do
    if [ -f "/etc/inetd.conf" ];then
        echo "/etc/inetd.conf íŒŒì¼ì´ ì¡´ìž¬í•©ë‹ˆë‹¤." >> $target
        for (( i=0; i<u21_cmdlen; i++ ))
        do
            if ! grep -iqE "^\s*#\s*$u21_checkrcommand_inetd\s*";then
                echo "$u21_checkrcommand_inetd ì„œë¹„ìŠ¤ê°€ í™œì„±í™” ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> $target
                u21_safe_check=$((u21_safe_check+))
                echo "ì„¤ì • ê°’ : $(grep -iE "^\s*#\s*$u21_checkrcommand_inetd\s*")" >> $target
            elif grep -iqE "^\s*$u21_checkrcommand_inetd\s*";then
                echo "$u21_checkrcommand_inetd ì„œë¹„ìŠ¤ê°€ ë¹„í™œì„±í™” ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> $target
            else
                echo "r-command ì„¤ì •ê°’ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
            fi
        done
    else
        echo "/etc/inetd.conf íŒŒì¼ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
        break
    fi
done
u21_checkconf=0
for u21_checkrcommand_xinetd in "${u21_checkrcommands[@]}"; do 
    if [ -f "/etc/xinetd.d/$u21_checkrcommand_xinetd" ];then   
        echo "/etc/xinetd.d/$u21_checkrcommand_xinetd íŒŒì¼ì´ ì¡´ìž¬ í•©ë‹ˆë‹¤." >> $target
        if ls -alL /etc/xinetd.d/* | grep -i "$u21_checkrcommand_xinetd" | awk '{print $9}' | awk -F'/' '{print $4}' | grep -iqvE "^k";then
            #u21_doubelcheckoption=$(sed -n "/service\s*$u21_checkrcommand_xinetd/,/}/p" "$u21_/etc/xinetd.d/$u21_checkrcommand_xinetd";)
            for u21_doublecheck in "${u21_checkrcommands[@]}";do
                #if [ -n "$u21_doubelcheckoption" ];then
                    u21_rcmdoption=$(sed -n "/service\s*$u21_doublecheck/,/}/p" "$u21_/etc/xinetd.d/$u21_checkrcommand_xinetd" | grep -ivE "^\s*#" | grep -iE "disable" | awk '{print tolower($3)}' | sed -n '1p')
                    if [[ $u21_rcmdoption == "no" ]];then
                        echo "r-command ì¤‘ $u21_checkrcommand_xinetd ì„œë¹„ìŠ¤ê°€ í™œì„±í™” ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> $target
                        u21_safe_check=$((u21_safe_check+))
                        break
                    elif [[ $u21_rcmdoption == "yes" ]];then
                        echo "r-command ì¤‘ $u21_checkrcommand_xinetd ì„œë¹„ìŠ¤ê°€ ë¹„í™œì„±í™” ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> $target
                        break
                    elif sed -n "/service\s*$u21_doublecheck/,/}/p" "/etc/xinetd.d/$u21_checkrcommand_xinetd" | grep -iE "^\s*#";then
                        echo "ì„¤ì •ê°’ì´ ì£¼ì„ì²˜ë¦¬ ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." 
                        break
                    else
                        u21_checkconf=$((u21_checkconf+1))  
                    fi
                #fi
            done
            if [[ $u21_checkconf -eq ${#u21_checkrcommands[@]} ]];then
                echo "ì„¤ì •ê°’ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
            fi
            u21_checkconf=0
        fi
    else
        echo "/etc/xinetd.d/$u21_checkrcommand_xinetd íŒŒì¼ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
    fi
done

if [[ $u21_safe_check -ge 1 ]];then
    u21=$((u21+1))
    echo "ì ê²€ ê²°ê³¼ : ì·¨ì•½" >> $result
else
    echo "ì ê²€ ê²°ê³¼ : ì–‘í˜¸" >> $result
fi
if [[ $u21 -ge 1 ]];then
    High=$((High+1))
    Service_Management=$((Service_Management+1))
    u21_Service_Management=1
fi