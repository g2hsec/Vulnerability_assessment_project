cat << EOF
===== [U-35] Removing a Web Service Directory Listing              =====
=====                  Chaking...........               =====
EOF
echo "--------------------------------------------------------------------------" >> $target
echo "                        U-35 ì›¹ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ… ì œê±°              " >> $target
echo "--------------------------------------------------------------------------" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "+ì ê²€ëª©ì  : ì™¸ë¶€ì—ì„œ ë””ë ‰í„°ë¦¬ ë‚´ì˜ ëª¨ë“  íŒŒì¼ì— ëŒ€í•œ ì ‘ê·¼ ë° ì—´ëžŒì„ ì œí•œí•¨ì„ ëª©ì ìœ¼ë¡œ í•¨" >> $target
echo "+ë³´ì•ˆìœ„í˜‘ : ë””ë ‰í„°ë¦¬ ê²€ìƒ‰ ê¸°ëŠ¥ì´ í™œì„±í™” ë˜ì–´ ìžˆì„ ê²½ìš°, ì‚¬ìš©ìžì—ê²Œ ë””ë ‰í„°ë¦¬ë‚´ íŒŒì¼ì´ í‘œì‹œë˜ì–´ WEB ì„œë²„ êµ¬ì¡° ë…¸ì¶œë¿ë§Œ ì•„ë‹ˆë¼ ë°±ì—… íŒŒì¼ì´ë‚˜ ì†ŒìŠ¤íŒŒì¼, ê³µê°œë˜ì–´ì„œëŠ” ì•ˆë˜ëŠ” íŒŒì¼ ë“±ì´ ë…¸ì¶œ ê°€ëŠ¥í•¨" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì–‘í˜¸ ðŸ”˜: ë””ë ‰í„°ë¦¬ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì·¨ì•½ ðŸš«: ë””ë ‰í„°ë¦¬ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "" >> $target
u35=0
u35_Service_Management=0
u35_safe_check=0
u35_apache_files=("/etc/httpd/conf.d/*.conf" "/etc/httpd/sites-available/*.conf" "/etc/httpd/sites-enabled/*.conf")
u35_nginx_files=("/etc/nginx/conf.d/*.conf")
u35_idx=0
u35_idxn=0
u35_apache_home_checks=("httpd.conf" "apache2.conf" ".htaccess")
u35_break=0
echo "â€»Cent OS 7 ê¸°ì¤€ Apache ë©”ì¸ ì„¤ì •íŒŒì¼ ê²½ë¡œì™€ Nginx ë©”ì¸ ì„¤ì • íŒŒì¼ì¸ /etc/nginx/nginx.confë¥¼ ì ê²€í•©ë‹ˆë‹¤. í•´ë‹¹ ê²½ë¡œê°€ ì¡´ìž¬í•˜ì§€ ì•Šì„ ê²½ìš°, ì•„íŒŒì¹˜ ì›¹ ì„œë¹„ìŠ¤ êµ¬ì„± íŒŒì¼ëª…ì„ í† ëŒ€ë¡œ íŒŒì¼ íƒìƒ‰ í›„ ì ê²€ì´ ì§„í–‰ë©ë‹ˆë‹¤. ì¤‘ë³µëœ íŒŒì¼ëª…ì´ ì¡´ìž¬í•  ê²½ìš° ìˆ˜ë™ ì ê²€ì„ ê¶Œìž¥í•©ë‹ˆë‹¤.â€»"  >> $target
for u35_apache_home_check in "${u35_apache_home_checks[@]}";do
    u35_apache_home=$(find / -type f -name "$u35_apache_home_check" 2> /dev/null | egrep -v "tmp|temp|swap|swp")
    if [ -f "$u35_apache_home" ];then
        echo "$u35_apache_home íŒŒì¼ì´ ì¡´ìž¬í•©ë‹ˆë‹¤." >> $target
        u35_dir_lisconfs_a=($(grep -vE "^\s*#" "$u35_apache_home" | sed -n '/<Directory/,/<\/Directory>/p' | grep -i "^\s*options" | grep -i indexes | awk '{print $1}' ))
        u35_check_dirpath_a=($(grep -vE "^\s*#" "$u35_apache_home" | awk 'BEGIN { inBlock = 0; block = "" }/<Directory/ {block = $0;inBlock = 1;dirPath = $2; gsub("\"", "", dirPath)}/<\/Directory>/ {block = block "\n" $0;inBlock = 0;if (block ~ /Indexes/) { print dirPath }block = ""}inBlock && ! /<\/Directory>/ { block = block "\n" $0 }' | tr -d '>'))
        for u35_dir_lisconf_a in "${u35_dir_lisconfs_a[@]}";do
            if [ -n $u35_dir_lisconf_a ];then
                echo "ì›¹ ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì´ í™œì„±í™” ìžˆìŠµë‹ˆë‹¤." >> $target
                echo "ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì´ í™œì„±í™”ëœ ë””ë ‰í† ë¦¬ ê²½ë¡œ : ${u35_check_dirpath_a[$u35_idx]}" >> $target
                u35_safe_check=$((u35_safe_check+1))
                u35_idx=$((u35_idx+1))
            else
                echo "ì›¹ ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì´ ë¹„í™œì„±í™” ë˜ì–´ ìžˆìŠµë‹ˆë‹¤" >> $target
                echo "ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì´ ë¹„í™œì„±í™”ëœ ë””ë ‰í† ë¦¬ ê²½ë¡œ : ${u35_check_dirpath_a[$u35_idx]}" >> $target
                u35_idxn=$((u35_idxn+1))
            fi
        done
        break
    else
        u35_idx=0
        if [[ $35_break -eq 1 ]];then
            break
        fi
        u35_break=$((u35_break+1))
        for u35_apache_file in "${u35_apache_files[@]}";do
            for u35_apache_check in $u35_apache_file;do
                if [ -f "$u35_apache_check" ];then
                    u35_adected_filecks=$(grep -vE "^\s*#" "$u35_apache_check" | grep -iw "options" | grep -iw "indexes" | grep -iwv "\-indexes" )
                    for u35_adected_fileck in "${u35_adected_filecks[@]}";do
                        if [[ -n "$u35_adected_fileck" ]];then
                            echo "$u35_apache_check íŒŒì¼ì—ì„œ ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì„ í—ˆìš©í•˜ëŠ” indexes ì„¤ì •ê°’ì´ ì¡´ìž¬í•©ë‹ˆë‹¤." >> $target
                            echo "ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì´ í™œì„±í™”ëœ ë””ë ‰í† ë¦¬ ê²½ë¡œ : ${u35_check_dirpath_a[$u35_idx]}" >> $target
                            u35_safe_check=$((u35_safe_check+1))
                            u35_idx=$((u35_idx+1))
                        else
                            echo "$u35_apache_check íŒŒì¼ì€ ì¡´ìž¬í•˜ì§€ë§Œ ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì„ í—ˆìš©í•˜ëŠ” indexes ì„¤ì •ê°’ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
                            u35_idxn=$((u35_idxn+1))
                        fi
                    done
                fi
            done
        done
        u35_idx=0
    fi
done
echo "ì¶”ê°€ì ì¸ Apache ì›¹ ì„œë¹„ìŠ¤ êµ¬ì„± íŒŒì¼ë“¤ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¶”ê°€ì ì¸ ìˆ˜ë™ ì ê²€ì„ ê¶Œìž¥í•©ë‹ˆë‹¤." >> $target
u35_idx=0
u35_idxn=0
if [ -f "/etc/nginx/nginx.conf" ];then
    echo "/etc/nginx/nginx.conf íŒŒì¼ì´ ì¡´ìž¬í•©ë‹ˆë‹¤." >> $target
    u35_dir_lisconfs_n=($(grep -vE "^\s*#" "/etc/nginx/nginx.conf" | grep -iw "^\s*autoindex" | sed 's/^[ \t]*//' | awk '{print tolower($2)}' | tr -d ';'))
    for u35_dir_lisconf_n in "${u35_dir_lisconfs_n[@]}";do
        if [[ $u35_dir_lisconf_n == "on" ]];then
            u35_safe_check=$((u35_safe_check+1))
            u35_idx=$((u35_idx+1))
        else
            u35_idxn=$((u35_idxn+1))
        fi
    done
    echo "ì›¹ ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì´ í™œì„±í™” ìžˆìŠµë‹ˆë‹¤." >> $target
    echo "ì„¤ì • ê°’ : $u35_dir_lisconf_n" >> $target
    echo "ì´ $u35_idx ê°œì˜ ì·¨ì•½í•œ on ì„¤ì •ì´ ì¡´ìž¬í•©ë‹ˆë‹¤. /etc/nginx/nginx.conf íŒŒì¼ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤." >> $target
    echo "ì›¹ ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì´ ë¹„í™œì„±í™”ëœ $u35_idxn ê°œì˜ ì•ˆì „í•œ  off ì„¤ì •ì´ ì¡´ìž¬ í•©ë‹ˆë‹¤. /etc/nginx/nginx.conf íŒŒì¼ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤." >> $target
else 
    echo "/etc/nginx/nginx.conf íŒŒì¼ì´ ì¡´ìž¬í•˜ì§€ ì•Šìœ¼ë©°, ì›¹ ì„œë¹„ìŠ¤ êµ¬ì„± íŒŒì¼ëª…ì„ í† ëŒ€ë¡œ ì ê²€ì„ ì§„í–‰í•©ë‹ˆë‹¤." >> $target
    for u35_ngnix_file in ${u35_nginx_files[@]};do
        for u35_nginx_check in $u35_ngnix_file;do
            u35_dir_lisconfs_n=($(grep -vE "^\s*#" "$u35_nginx_check" 2> /dev/null | grep -iw "^\s*autoindex" | sed 's/^[ \t]*//' | awk '{print tolower($2)}' | tr -d ';'))
            if [ -f "$u35_nginx_check" ];then
                #u35_ndected_filecks=$(grep -vE "^\s*#" "$u35_nginx_check" | grep -iw "autoindex" | tr -d ';' | grep -iw "on")
                for u35_dir_lisconf_n in "${u35_dir_lisconfs_n[@]}";do
                    if [ -n "$u35_dir_lisconf_n" ];then
                        if [ "$u35_dir_lisconf_n" == "on" ];then
                            u35_safe_check=$((u35_safe_check+1))
                            u35_idx=$((u35_idx+1))
                        else
                            u35_idxn=$((u35_idxn+1))
                        fi
                    else
                        echo "$u35_nginx_check íŒŒì¼ì€ ì¡´ìž¬í•˜ì§€ë§Œ ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì„ í—ˆìš©í•˜ëŠ” autoindex ì„¤ì •ê°’ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
                        u35_idxn=$((u35_idxn+1))
                    fi
                done
                if [[ $u35_idx -ge 1 ]];then
                    echo "$u35_nginx_check íŒŒì¼ì—ì„œ ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì´ í—ˆìš©ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> $target
                    echo "ì„¤ì • ê°’ : $u35_dir_lisconf_n" >> $target
                    echo "ì´ $u35_idx ê°œì˜ ì·¨ì•½í•œ on ì„¤ì •ì´ ì¡´ìž¬í•©ë‹ˆë‹¤. $u35_nginx_check íŒŒì¼ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤." >> $target
                    echo "ì›¹ ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…ì´ ë¹„í™œì„±í™”ëœ $u35_idxn ê°œì˜ ì•ˆì „í•œ  off ì„¤ì •ì´ ì¡´ìž¬ í•©ë‹ˆë‹¤. $u35_nginx_check íŒŒì¼ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤." >> $target
                fi
            fi
        done
    done
    echo "ì¶”ê°€ì ì¸ ì›¹ ì„œë¹„ìŠ¤ êµ¬ì„± íŒŒì¼ë“¤ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¶”ê°€ì ì¸ ìˆ˜ë™ ì ê²€ì„ ê¶Œìž¥í•©ë‹ˆë‹¤." >> $target
fi
if [[ $u35_safe_check -ge 1 ]];then
    u35=$((u35+1))
    echo "ì ê²€ ê²°ê³¼ : ì·¨ì•½" >> $result
else
    echo "ì ê²€ ê²°ê³¼ : ì–‘í˜¸" >> $result
fi
if [[ $u35 -ge 1 ]];then
    High=$((High+1))
    Service_Management=$((Service_Management+1))
    u35_Service_Management=1
fi