cat << EOF
===== [U-01] Remote Login Permission for the root User  =====
=====                  Chaking...........               =====
EOF
echo "--------------------------------------------------------------------------" >> $target
echo "                        U-01 root ê³„ì • ì›ê²© ì ‘ì† ì œí•œ                         "  >> $target
echo "--------------------------------------------------------------------------" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "ì ê²€ëª©ì  : ê´€ë¦¬ìžê³„ì • íƒˆì·¨ë¡œ ì¸í•œ ì‹œìŠ¤í…œ ìž¥ì•…ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì™¸ë¶€ ë¹„ì¸ê°€ìžì˜ root ê³„ì • ì ‘ê·¼ ì‹œë„ë¥¼ ì›ì²œì ìœ¼ë¡œ ì°¨ë‹¨í•˜ê¸° ìœ„í•¨" >> $target
echo "ë³´ì•ˆìœ„í˜‘ : root ê³„ì •ì€ ìš´ì˜ì²´ì œì˜ ëª¨ë“ ê¸°ëŠ¥ì„ ì„¤ì • ë° ë³€ê²½ì´ ê°€ëŠ¥í•˜ì—¬(í”„ë¡œì„¸ìŠ¤, ì»¤ë„ë³€ê²½ ë“±) root ê³„ì •ì„ íƒˆì·¨í•˜ì—¬ ì™¸ë¶€ì—ì„œ ì›ê²©ì„ ì´ìš©í•œ ì‹œìŠ¤í…œ ìž¥ì•… ë° ê°ì¢… ê³µê²©ìœ¼ë¡œ(ë¬´ìž‘ìœ„ ëŒ€ìž… ê³µê²©) ì¸í•œ root ê³„ì • ì‚¬ìš© ë¶ˆê°€ ìœ„í˜‘" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì–‘í˜¸ ðŸ”˜: ì›ê²© í„°ë¯¸ë„ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜, ì‚¬ìš© ì‹œ root ì§ì ‘ ì ‘ì†ì„ ì°¨ë‹¨í•œ ê²½ìš°" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì·¨ì•½ ðŸš«: ì›ê²© í„°ë¯¸ë„ ì„œë¹„ìŠ¤ ì‚¬ìš© ì‹œ root ì§ì ‘ ì ‘ì†ì„ í—ˆìš©í•œ ê²½ìš°" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "" >> $target
echo "-------------" >> $result
echo "U-1 ì ê²€ ê²°ê³¼" >> $result
u1=0
u1_safe_check=0
u1_Account_Management=0
telnet_access_check() {
    if [ -f "/etc/securetty" ]; then
        echo "/etc/securetty íŒŒì¼: ì¡´ìž¬í•¨" >> "$target"
        if grep -q "pts" "/etc/securetty"; then
            echo "  - pts í•­ëª©: ë°œê²¬ë¨ " >> "$target"
            u1_safe_check=$((u1_safe_check+1))
        else
            echo "  - pts í•­ëª©: ë°œê²¬ë˜ì§€ ì•ŠìŒ" >> "$target"
        fi
    else
        echo "/etc/securetty íŒŒì¼ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> "$target"
    fi
    
    if [ -f "/etc/pam.d/login" ]; then
        echo "/etc/pam.d/login íŒŒì¼ì´ ì¡´ìž¬í•©ë‹ˆë‹¤." >> "$target"
        if grep -qiE "^\s*#\s*auth\s*required\s*/lib/security/pam_securetty.so" "/etc/pam.d/login"; then
            echo 'auth required /lib/security/pam_securetty.so í•­ëª©ì´ ì£¼ì„ì²˜ë¦¬ ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.' >> "$target"
            u1_safe_check=$((u1_safe_check+1))
        else
            if grep -qiE "^\s*auth\s*required\s*/lib/security/pam_securetty.so" "/etc/pam.d/login"; then
                echo "auth required /lib/security/pam_securetty.so í•­ëª©: ë°œê²¬ë¨" >> "$target"
            else
                echo "auth required /lib/security/pam_securetty.so í•­ëª©: ë¹„í™œì„±í™”" >> "$target"
                u1_safe_check=$((u1_safe_check+1))
            fi
        fi
    else
        echo "/etc/pam.d/login íŒŒì¼ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> "$target"
    fi
    if [[ $u1_safe_check -ge 1 ]];then
        echo "ì ê²€ ê²°ê³¼ : ì·¨ì•½"
        u1=$((u1+1))
    else
        echo "ì ê²€ ê²°ê³¼ : ì–‘í˜¸"
    fi
}
if pgrep "telnetd" > /dev/null; then
    echo "Telnet ì„œë¹„ìŠ¤: ë™ìž‘ ì¤‘"
    telnet_access_check	
else
    if grep -q '^telnet[[:space:]]*23/tcp' /etc/services; then
        if sudo netstat -tuln | grep :23  > /dev/null; then
            telnet_access_check
        else
	    echo 'telnet í”„ë¡œì„¸ìŠ¤: ë™ìž‘ ì¤‘ì´ ì•„ë‹˜' >> $target
        fi
    else
        echo 'telnet ê¸°ë³¸ í¬íŠ¸ 23ìœ¼ë¡œ ì„¤ì •ë˜ì–´ìžˆì§€ ì•ŠìŒ' >> $target
        u1_telnet_newport=$(grep '^telnet[[:space:]]' /etc/services | awk '{print $2}' | cut -d'/' -f1)
        if sudo netstat -tuln | grep :$u1_telnet_newport  > /dev/null; then
            telnet_access_check
        else
	    echo 'telnet í”„ë¡œì„¸ìŠ¤: ë™ìž‘ ì¤‘ì´ ì•„ë‹˜' >> $target
        fi
    fi
fi
ssh_access_check() {
    # /etc/ssh/sshd_config íŒŒì¼ ì²´í¬
    if [ -f "/etc/ssh/sshd_config" ]; then
        echo "/etc/ssh/sshd_config íŒŒì¼: ì¡´ìž¬í•¨" >> "$target"
        if grep -iqE "^\s*#\s*PermitRootLogin" "/etc/ssh/sshd_config"; then
            echo 'PermitRootLogin í•­ëª©ì´ ì£¼ì„ì²˜ë¦¬ ë˜ì–´ìžˆìŠµë‹ˆë‹¤. : ë¹„í™œì„±í™”' >> "$target"
            u1_safe_check=$((u1_safe_check+1))
        else
            if grep -iE '^\s*PermitRootLogin' "/etc/ssh/sshd_config" | awk '{print tolower($2)}' | grep -iq 'yes'; then
                echo "  - PermitRootLogin Yes : ë°œê²¬ë¨" >> "$target"
                u1_safe_check=$((u1_safe_check+1))
            else
                echo "  - PermitRootLogin Yes : ë°œê²¬ë˜ì§€ ì•ŠìŒ" >> "$target"
            fi
        fi
    else
        echo "/etc/ssh/sshd_config íŒŒì¼: ì¡´ìž¬í•˜ì§€ ì•ŠìŒ" >> "$target"
    fi

    # /etc/pam.d/sshd íŒŒì¼ ì²´í¬
    if [ -f "/etc/pam.d/sshd" ]; then
        echo "/etc/pam.d/sshd íŒŒì¼: ì¡´ìž¬í•¨" >> "$target"
        if grep -qiE "^\s*#\s*auth\s*required\s*pam_securetty.so" "/etc/pam.d/sshd"; then
            echo "pam_securetty.so ëª¨ë“ˆ ì‚¬ìš©ì´ ì£¼ì„ì²˜ë¦¬ë˜ì–´ìžˆìŠµë‹ˆë‹¤. : ë¹„í™œì„±í™”" >> "$target"
            u1_safe_check=$((u1_safe_check+1))
        else
            if grep -qiE "^\s*auth\s*required\s*pam_securetty.so" "/etc/pam.d/sshd"; then
                echo "pam_securetty.so ëª¨ë“ˆì„ ì‚¬ìš©í•˜ê³  ìžˆìŠµë‹ˆë‹¤." >> "$target"
            else
                echo "pam_securetty.so ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ìžˆìŠµë‹ˆë‹¤." >> "$target"
                u1_safe_check=$((u1_safe_check+1))
            fi
        fi

        if grep -qiE "^\s*#\s*AllowUsers" "/etc/pam.d/sshd"; then
            echo "AllowUsers í•­ëª©ì€ ì£¼ì„ì²˜ë¦¬ ë˜ì–´ ë¹„í™œì„±í™” ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> "$target"
        else
            if grep -qiE "^\s*AllowUsers" "/etc/pam.d/sshd"; then
                if grep -qiE "\s*AllowUsers\s*root" "/etc/pam.d/sshd"; then
                    echo "AllowUsers í•­ëª©ì— rootê°€ ì„¤ì •ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> "$target"
                    u1_safe_check=$((u1_safe_check+1))
                else
                    echo "AllowUsers í•­ëª©ì´ ì•ˆì „í•˜ê²Œ ì„¤ì •ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> "$target"
                fi
            else
                echo "AllowUsers í•­ëª©ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> "$target"
            fi
        fi

        if grep -qiE "^\s*#\s*AllowGroups" "/etc/pam.d/sshd"; then
            echo "AllowGroups í•­ëª©ì€ ì£¼ì„ì²˜ë¦¬ ë˜ì–´ ë¹„í™œì„±í™” ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> "$target"
        else
            if grep -qiE "^\s*AllowGroups" "/etc/pam.d/sshd"; then
                if grep -qiE "\s*AllowGroups\s*root" "/etc/pam.d/sshd"; then
                    echo "AllowGroups í•­ëª©ì— rootê°€ ì„¤ì •ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> "$target"
                    u1_safe_check=$((u1_safe_check+1))
                else
                    echo "AllowGroups í•­ëª©ì´ ì•ˆì „í•˜ê²Œ ì„¤ì •ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> "$target"
                fi
            else
                echo "AllowGroups í•­ëª©ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> "$target"
            fi
        fi
    else
        echo "/etc/pam.d/sshd íŒŒì¼ : ì¡´ìž¬í•˜ì§€ ì•ŠìŒ" >> "$target"
    fi
    if [[ $u1_safe_check -ge 1 ]];then
        echo "ì ê²€ ê²°ê³¼ : ì·¨ì•½" >> $result
        u1=$((u1+1))
    else
        echo "ì ê²€ ê²°ê³¼ : ì–‘í˜¸" >> $result
    fi
}
if pgrep "sshd" > /dev/null; then
    echo "sshd í”„ë¡œì„¸ìŠ¤: ë™ìž‘ ì¤‘" >> $target
    ssh_access_check
else
    if grep -q '^ssh[[:space:]]*22/tcp' /etc/services; then
    	if sudo netstat -tuln | grep :22  > /dev/null; then
    	    ssh_access_check
    	else
    	    echo "sshd í”„ë¡œì„¸ìŠ¤: ë™ìž‘ ì¤‘ì´ ì•„ë‹˜" >> $target
    	fi
    else
        echo 'ssh ê¸°ë³¸ í¬íŠ¸ 22ìœ¼ë¡œ ì„¤ì •ë˜ì–´ìžˆì§€ ì•ŠìŒ' >> $target
        u1_ssh_newport=$(grep '^sshd[[:space:]]' /etc/services | awk '{print $2}' | cut -d'/' -f1)
        if sudo netstat -tuln | grep :$u1_ssh_newport  > /dev/null; then
            ssh_access_check	    
    	else
    	    echo "sshd í”„ë¡œì„¸ìŠ¤: ë™ìž‘ ì¤‘ì´ ì•„ë‹˜" >> $target
    	fi
    fi
fi

if [ $u1 -ge 1 ];then
    High=$((High+1))
    Account_Management=$((Account_Management+1))
    u1_Account_Management=1
fi