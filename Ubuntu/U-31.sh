cat << EOF
===== [U-31] Spam mail relay restrictions              =====
=====                  Chaking...........               =====
EOF
echo "--------------------------------------------------------------------------" >> $target
echo "                        U-31 ìŠ¤íŒ¸ ë©”ì¼ ë¦´ë ˆì´ ì œí•œ              " >> $target
echo "--------------------------------------------------------------------------" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "+ì ê²€ëª©ì  : ìŠ¤íŒ¸ ë©”ì¼ ì„œë²„ë¡œì˜ ì•…ìš©ë°©ì§€ ë° ì„œë²„ ê³¼ë¶€í•˜ì˜ ë°©ì§€ë¥¼ ìœ„í•¨" >> $target
echo "+ë³´ì•ˆìœ„í˜‘ : SMTP ì„œë²„ì˜ ë¦´ë ˆì´ ê¸°ëŠ¥ì„ ì œí•œí•˜ì§€ ì•ŠëŠ” ê²½ìš°, ì•…ì˜ì ì¸ ì‚¬ìš©ëª©ì ì„ ê°€ì§„ ì‚¬ìš©ìžë“¤ì´ ìŠ¤íŒ¸ë©”ì¼ ì„œë²„ë¡œ ì‚¬ìš©í•˜ê±°ë‚˜ Dosê³µê²©ì˜ ëŒ€ìƒì´ ë  ìˆ˜ ìžˆìŒ" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì–‘í˜¸ ðŸ”˜: SMTP ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜ ë¦´ë ˆì´ ì œí•œì´ ì„¤ì •ë˜ì–´ ìžˆëŠ” ê²½ìš°" >> $target
echo "+íŒë‹¨ê¸°ì¤€ ì·¨ì•½ ðŸš«: SMTP ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©° ë¦´ë ˆì´ ì œí•œì´ ì„¤ì •ë˜ì–´ ìžˆì§€ ì•Šì€ ê²½ìš°" >> $target
echo "++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> $target
echo "" >> $target
u31=0
u31_Service_Management=0
u31_safe_check=0
u31_service=("sendmail" "postfix" "exim" "sendmail.service" "postfix.service" "exim.service")
u31_ports=("25" "465" "587")
u31_logic() {
    if [ -f "/etc/mail/sendmail.cf" ];then
        echo "/etc/mail/sendmail.cf íŒŒì¼ì´ ì¡´ìž¬í•©ë‹ˆë‹¤." >> $target
        if grep -iv "^\s*#" "/etc/mail/sendmail.cf" | grep -iqE 'R\$\*\s*\$:\s*\$1\s*RELAY';then
            echo "ëª¨ë“  ì¡°ê±´ì—ì„œ ëª¨ë“  ë¦´ë ˆì´ë¥¼ í—ˆìš©í•˜ëŠ” ê·œì¹™ì´ ì •ì˜ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> $target
            u31_safe_check=$((u31_safe_check+1))
        elif grep -ivE "^\s*#" "/etc/mail/sendmail.cf" | grep -iE 'R\$\s*' | grep -iqE '\$@\s*5\.7\.1|(Relaying|Relay?ing)\s*(denie?d|denied)';then
            echo "ë¦´ë ˆì´ë¥¼ ì œí•œí•˜ëŠ” ê·œì¹™ì´ ì •ì˜ë˜ì–´ ìžˆìŠµë‹ˆë‹¤." >> $target
        else
            echo "/etc/mail/sendmail.cf íŒŒì¼ ë‚´ì—ì„œ ëª¨ë“  ì¡°ê±´ì—ì„œ ëª¨ë“  ë¦´ë ˆì´ë¥¼ í—ˆìš©í•˜ëŠ” ê·œì¹™ ë° ë¦´ë ˆì´ë¥¼ ì œí•œí•˜ëŠ” ê·œì¹™ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
        fi
    else
        echo "/etc/mail/sendmail.cf íŒŒì¼ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
    fi
    if [ -f "/etc/mail/access" ];then
        echo "/etc/mail/access íŒŒì¼ì´ ì¡´ìž¬í•©ë‹ˆë‹¤." >> $target
        if grep -vE "^\s*#" "/etc/mail/access" | grep -iqE "\s*Connect:ALL\s*RELAY";then
            echo "ëª¨ë“  ì—°ê²°ì— ëŒ€í•œ ë¦´ë ˆì´ ì„¤ì •ì´ ì¡´ìž¬í•©ë‹ˆë‹¤." >> $target
            u31_safe_check=$((u31_safe_check+1))
        else
            if grep -vE "^\s*#" "/etc/mail/access" | grep -iE "relay$" | awk '{print $1}' | awk -F':' '{print $2}' | grep -ivqE "localhost.localdomain|localhost|127.0.0.1|127|IPv6:::1|IPv6";then
                echo "localhostë¥¼ ì œì™¸í•œ IP, domain, Email Addressì— ëŒ€í•œ ë¦´ë ˆì´ í—ˆìš© ì„¤ì •ê°’ì´ ì¡´ìž¬í•©ë‹ˆë‹¤."  >> $target
            else
                echo "localhostë¥¼ ì œì™¸í•œ IP, domain, Email Addressì— ëŒ€í•œ ë¦´ë ˆì´ í—ˆìš©ì„ ì œì™¸í•œ ì„¤ì •ê°’ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
            fi
        fi
    else
        echo "/etc/mail/access íŒŒì¼ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
    fi
}

check_service_status "${u31_ports}" "${u31_service[@]}"
if [[ $? -eq 1 ]]; then
    echo "sendmail ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìžˆìŠµë‹ˆë‹¤." >> $target
    u31_logic
    u31_safe_check=$((u31_safe_check+1))
else
    echo "sendmail ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìžˆì§€ ì•ŠìŠµë‹ˆë‹¤." >> $target
    u31_logic
fi

if [[ $u31_safe_check -ge 1 ]];then
    u31=$((u31+1))
    echo "ì ê²€ ê²°ê³¼ : ì·¨ì•½" >> $result
else
    echo "ì ê²€ ê²°ê³¼ : ì–‘í˜¸" >> $result
fi
if [[ $u31 -ge 1 ]];then
    High=$((High+1))
    Service_Management=$((Service_Management+1))
    u31_Service_Management=1
fi